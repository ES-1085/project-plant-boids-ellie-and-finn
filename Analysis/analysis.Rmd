---
title: "Data analysis"
author: "Ellie and Finn"
output:
  html_document:
    df_print: paged
---
```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(leaflet) ## For leaflet interactive maps
library(sf) ## For spatial data
library(RColorBrewer) ## For colour palettes
library(htmltools) ## For html
library(leafsync) ## For placing plots side by side
library(stringr) ## For character string manipulation
library(kableExtra) ## Table  output (in slides)
```

Read in data files
```{r, read-in-vegetation-file, echo = FALSE}
island_veg <- read_csv("../data/island_veg.csv")
veg_attributes <- read_csv("../data/plotpointsattributes.csv")
```
-
```{r, read-in-bird-files, echo = FALSE}
gdi_bird <- st_read("../data/gull data/gdi_nests/gdi_nests_Merge.shp")
heron_bird <- st_read("../data/gull data/heron_nests/herg_nests_heron.shp")
#coei_schoodic_bird <- st_read("../data/gull data/schoodic_nests/coei_nests.shp")
#gbbg_schoodic_bird <- st_read("../data/gull data/schoodic_nests/gbbg_nests.shp")
#herg_schoodic_bird <- st_read("../data/gull data/schoodic_nests/herg_nests.shp")
schoodic_bird <- st_read("../data/gull data/schoodic_nests/all_nests.shp")
shabby_bird <- st_read("../data/gull data/shabby_nests/gull_eider_nests.shp")
```
Tidy bird data
```{r, create-location-colmn-birds}
gdi_bird$location <- c("gdi")
heron_bird$location <- c("heron")
shabby_bird$location <- c("shabby")
schoodic_bird$location <- c("schoodic")
```
-
```{r, recode-shabby-column-names}
  colnames(shabby_bird)[which(names(shabby_bird) == "Point_ge_4")] <- "GPS_Date"
  colnames(shabby_bird)[which(names(shabby_bird) == "shabby_i_2")] <- "species"
  colnames(shabby_bird)[which(names(shabby_bird) == "Point_gene")] <- "Point_ID"
```
-
```{r, recode-schoodic-column-names}
  colnames(schoodic_bird)[which(names(schoodic_bird) == "all_nest_3")] <- "GPS_Date"
  colnames(schoodic_bird)[which(names(schoodic_bird) == "schoodic_2")] <- "species"
  colnames(schoodic_bird)[which(names(schoodic_bird) == "schoodic_c")] <- "Point_ID"
```
-
```{r, select-relevant-columns-in-bird-data}
gdi_bird_all <- gdi_bird %>%
  select(Point_ID, GPS_Date, species, location, geometry)
 
heron_bird_all <- heron_bird %>%
  mutate(species = "herring gull") %>% #create species column for heron
  select(Point_ID, GPS_Date, species, location, geometry)
  
shabby_bird_all <- shabby_bird %>%
  select(Point_ID, GPS_Date, species, location, geometry)

schoodic_bird_all <- schoodic_bird %>%
  select(Point_ID, GPS_Date, species, location, geometry)
```
-
```{r, combine-bird-datasets-for-all-islands}
island_bird <- rbind(gdi_bird_all, heron_bird_all, shabby_bird_all, schoodic_bird_all)
```
-

```{r, rename-bird-species-with-full-names}
island_bird <- island_bird %>%
  mutate(species = case_when(
    species == "gbbg" ~ "great black-backed gull",
    species == "herg" ~ "herring gull",
    species == "coei" ~ "common eider",
    species == "dcco" ~ "double-crested cormorant",
    species == "cago" ~ "canada goose",
    TRUE ~ species
  )) %>% 
  filter(!is.na(species)) %>% 
  filter(species != "NA")
```

Tidy vegetation data
```{r join veg & coordinates}
island_veg_all <- island_veg %>%
                  left_join(veg_attributes, join_by("gps" == "name"))
```
-
```{r standardize-island-naming}
island_veg_all <- island_veg_all %>%
  mutate(location = case_when(
    location == "Schoodic" ~ "schoodic",
    location == "GDI" ~ "gdi",
    TRUE ~ location
  ))
```
-
```{r, recode-veg-height-class-names}
 island_veg_all <- island_veg_all %>%
mutate(height_class = case_when(TRUE ~ as.factor(height))) %>% #making height class a factor variable in order to use it in a bar chart
  mutate(height_class_range = case_when(
    height_class == "1" ~ "0-0.15",
    height_class == "2" ~ "0.15-0.30",
    height_class == "3" ~ "0.30-1",
    height_class == "4" ~ "1-1.5",
    height_class == "5" ~ "1.5+"
  ))
```
-
```{r, recode-veg-cover-names}
island_veg_all <- island_veg_all %>%
  mutate(percent_cover_range = case_when(
    cover == "1" ~ "0-0.01",
    cover == "5" ~ "0.02-0.05",
    cover == "25" ~ "0.06-0.25",
    cover == "50" ~ "0.26-0.50",
    cover == "75" ~ "0.51-0.75",
    cover == "100" ~ "0.76-1.00"
  ))
```

-
```{r standardize spp (veg)}
island_veg_all <- island_veg_all %>% 
  mutate(spp = case_when(
    spp == "achillea millefolium" ~ "Achillea millefolium",
    spp == "agrostis scabra" ~ "Agrostis scabra",
    spp == "agrostis stolonifera" ~ "Agrostis stolonifera",
    spp == "arctium sp" ~ "Arctium sp.",
    spp == "calystegia sepium" ~ "Calystegia sepium",
    spp == "carex nigra" ~ "Carex nigra",
    spp == "cerastium arvense" ~ "Cerastium arvense",
    spp == "cerastium fontana" ~ "Cerastium fontanum",
    spp == "cerastium fontanum" ~ "Cerastium fontanum",
    spp == "cirsium arvense" ~ "Cirsium arvense",
    spp == "cirsium vulgare" ~ "Cirsium vulgare",
    spp == "cornus canadensis" ~ "Cornus canadensis",
    spp == "cuscuta gronovii" ~ "Cuscuta gronovii",
    spp == "doellingeria umbellata" ~ "Doellingeria umbellata",
    spp == "festuca rubra" ~ "Festuca rubra",
    spp == "fragaria virginiana" ~ "Fragaria virginiana",
    spp == "hieracium caespitosum" ~ "Hieracium caespitosum",
    spp == "impatiens capensis" ~ "Impatiens capensis",
    spp == "iris versicolor" ~ "Iris versicolor",
    spp == "lathyrus japonicus" ~ "Lathyrus japonicus",
    spp == "lathyrus palustris" ~ "Lathyrus palustris",
    spp == "luzula multiflora" ~ "Luzula multiflora",
    spp == "maianthemum canadense" ~ "Maianthemum canadense",
    spp == "matricaria discoidea" ~ "Matricaria discoidea",
    spp == "myrica gale" ~ "Myrica gale",
    spp == "osmundastrum cinnamomeum" ~ "Osmundastrum cinnamomeum",
    spp == "plantago major" ~ "Plantago major",
    spp == "poa pratensis" ~ "Poa pratensis",
    spp == "Poa spp (tufting)" ~ "Poa sp.",
    spp == "potentilla anserina" ~ "Potentilla anserina",
    spp == "potentilla norvegica" ~ "Potentilla norvegica",
    spp == "potentilla simplex" ~ "Potentilla simplex",
    spp == "ranunculus acris" ~ "Ranunculus acris",
    spp == "rubus hispidus" ~ "Rubus hispidus",
    spp == "rubus idaeus" ~ "Rubus idaeus",
    spp == "rumex acetosella" ~ "Rumex acetosella",
    spp == "rumex longifolius" ~ "Rumex longifolius",
    spp == "rumex sp." ~ "Rumex sp.",
    spp == "scutellaria galericulata" ~ "Scutellaria galericulata",
    spp == "solanum dulcamara" ~ "Solanum dulcamara",
    spp == "solidago rugosa" ~ "Solidago rugosa",
    spp == "solidago sempervirens" ~ "Solidago sempervirens",
    spp == "spiraea alba" ~ "Spiraea alba",
    spp == "stellaria media" ~ "Stellaria media",
    spp == "Strawberry" ~ "Fragaria virginiana",
    spp == "symphotrichum novae-angliae" ~ "Symphotrichum novae-angliae",
    spp == "taraxacum officinale" ~ "Taraxacum officinale",
    spp == "taraxacum officionale" ~ "Taraxacum officinale",
    spp == "trifolium repens" ~ "Trifolium repens",
    spp == "urtica dioica" ~ "Urtica dioica",
    spp == "vaccinium angustifolium" ~ "Vaccinium angustifolium",
    spp == "valeriana officionalis" ~ "Valeriana officinalis",
    spp == "Valeriana officionalis" ~ "Valeriana officinalis",
    spp == "valeriana officinalis" ~ "Valeriana officinalis",
    spp == "veronica arvensis" ~ "Veronica arvensis",
    TRUE ~ spp
  ))
print(island_veg_all)
```
-
```{r insert IDs (veg)}
island_veg_all <- island_veg_all %>% 
  mutate(spp = case_when(
    spp == "Min lat" ~ "Moehringia lateriflora",
    spp == "Calamagrostis #8" ~ "Poa pratensis",
    spp == "grass #54" ~ "Poa pratensis",
    spp == "Poa pratensis (#16)" ~ "Poa pratensis",
    spp == "Poa pratensis #16)" ~ "Poa pratensis",
    spp == "Poa spp #19" ~ "Alopecurus pratensis",
    spp == "elymus #33" ~ "Elymus trachycaulus",
    spp == "grass #74" ~ "Agrostis stolonifera",
    spp == "Poa #3" ~ "Poa trivialis",
    spp == "#53" ~ "Capsella bursa-pastoris",
    spp == "Poaceae #84" ~ "Elymus repens",
    spp == "Sedge #82" ~ "Carex silicea",
    spp == "Dock sp #45" ~ "Rumex britannica",
    spp == "dock sp #51" ~ "Rumex crispa",
    spp == "Poaceae #22" ~ "Anthoxanthum odoratum",
    spp == "Vetch #99" ~ "Lathyrus palustris",
    TRUE ~ spp
  ))
```
-
```{r, find-unique-species-veg}
unique <- unique(island_veg_all$spp)
sort(unique)
```

Vislualize bird data
```{r, bird-species-bar-plot-by-island}
#I'm trying to figure out how to display totals on the ends of the bars so you can see numbers that don't show up in the bars. 
island_bird %>%
  ggplot(mapping = aes(y = species),
    na.rm = TRUE) +
  geom_bar(fill = "#21918c") +
  facet_wrap(~location, nrow = 1) +
  theme(axis.text.y = element_text(vjust = 10)) +
  theme_minimal() + 
  labs(title = "Seabird disribution by island",
       x = "Number of occurences",
       y = "Bird species")
```
-
```{r, species-percentage-by-island}
island_bird %>%
  ggplot(mapping = aes(x = location, fill = (species))) + 
  geom_bar(position = "fill") +
  scale_fill_viridis_d() +
  labs(title = "Bird species on each island",
       x = "Island",
       y = "Proportion of species",
       fill = "Bird species") +
  theme_minimal()
```


Visualize vegetation data
```{r species-barplot-by-island, fig.height=10, dev='jpeg'}
island_veg_all %>%
  filter(spp != "unknown") %>% #filtering out all of the unknown species
  ggplot(mapping = aes(y = spp)
    ) +
  geom_bar(fill = "#21918c") +
  facet_wrap(~location, nrow = 1) +
  theme(axis.text.y = element_text(vjust = 10)) +
  theme_minimal() + 
  labs(title = "Vegetation frequency by island",
       x = "Number of occurences",
       y = "Scientific names")


# png("island_plot.png", width = 480, height = 480)
# island_veg %>%
#   filter(common != "unknown") %>% #filtering out all of the unknown species
#   ggplot(mapping = aes(y = common)
#     ) +
#   geom_bar(fill = "#21918c") +
#   facet_wrap(~location, nrow = 1) +
#   theme(axis.text.y = element_text(vjust = 10)) +
#   theme_minimal() + 
#   labs(title = "Species disribution by island",
#        x = "Number of occurences",
#        y = "Common names")
# dev.off()
```
-
```{r height-class-distribution-by-island-bar-plot}
island_veg_all %>%
  ggplot(mapping = aes(x = location, fill = fct_rev(height_class_range))) + #reversing height class so the tallest appears on top
  geom_bar(position = "fill") +
  scale_fill_viridis_d() +
  labs(title = "Height classes on each island",
       x = "Island",
       y = "Proportion on height class",
       fill = "Plant height classes (m)") +
  theme_minimal()
```
<<<<<<< HEAD


```{r}
# =======
# -
# ```{r leaflet}
# >>>>>>> bb7949e6f5236b825be637c85e47178b8fae9fc4
# island_veg_all %>%
# #         # select("cover", "height_class_range", "common", "spp", "POINT_X", "POINT_Y") %>%
# #         # rename("percent cover" = "cover", "height class" = "height_class_range", "common name" = "common", "species" = "spp", "long" = "POINT_X", "lat" = "POINT_Y") %>%
# sf(data = island_veg_all) %>%
# addTiles() %>%
# setView(lng = -68,
#         lat = 44,
#         zoom = 10) %>%
#   addCircleMarkers(~POINT_X, ~POINT_Y)
```

